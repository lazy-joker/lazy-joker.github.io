{"componentChunkName":"component---src-templates-blog-article-js","path":"/article/202011-iot-dynamodb","result":{"data":{"microcmsArticles":{"title":"AWS IoT Coreで取得したデータをDynamoDBで保存","body":"<h2 id=\"hc77b57de51\">あらまし</h2><p><a href=\"https://proactive-cybernetics.github.io/article/202011-aws-iot\" target=\"_blank\" rel=\"noopener noreferrer\">前回の記事</a>では、AWS IoT Coreでモノの登録を行い、<br>Raspberry Piに、登録されたモノとしてAWS IoTに<br>定期的にセンサの測定値を送信するPythonプログラムを<br>動作させるようにしました。<br><br>今回は、AWS IoT Coreにモノから送られてくる<br>センサの測定値をDynamoDBに保存するよう<br>AWSの設定画面から設定を行っていきます。<br></p><h2 id=\"h087573d1f5\">AWS IoT アクションの追加</h2><p>AWS IoTのコンソールで、「ACT」→「ルール」を開きます。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20220424.png\" alt><br><br>「ルール」を開いたら、「作成」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20220524.png\" alt><br><br>ルールの名称と、説明を入力します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20220813.png\" alt><br><br>「ルールクエリステートメント」を設定します。<br><a href=\"https://proactive-cybernetics.github.io/article/202011-aws-iot\" target=\"_blank\" rel=\"noopener noreferrer\">前回の記事</a>では、Pythonプログラムから投稿するMQTTトピックは<br>「test」としているので、この欄には<br>「SELECT * FROM &#x27;test&#x27;」を入力します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20224253.png\" alt><br><br>「アクションの追加」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20220925.png\" alt><br><br>「アクションを選択してください」と表示されるので、その下の<br>「DynamoDBテーブルにメッセージを挿入する」を選択し、<br>「アクションの設定」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20221039.png\" alt><br><br>「アクションの設定」と表示されるので、「テーブル名」欄の「新しいリソースを作成」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20221409.png\" alt><br></p><h2 id=\"h02fc0ab5ae\">新規DynamoDBテーブルの作成</h2><p>DynamoDBのダッシュボードが表示されるので、「テーブルの作成」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20221535.png\" alt><br><br>テーブルの各設定を入力して、「作成」を選択します。<br><br>今回は、「パーティションキー」を「node-id」という名前の文字列、<br>「ソートキー」を「timestamp」という名前の数値にします。<br><br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20222305.png\" alt><br></p><h2 id=\"h8cb9b10c5a\">テーブルに追加するデータの指定</h2><p>AWS IoTの「ルールの作成」画面に戻って、「テーブル名」に<br>先ほど作成したテーブルの名前を入れます。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20223704.png\" alt><br><br>「テーブル名」を入れると「パーティションキー」と「レンジキー」の欄が<br>自動で埋められます。<br>「パーティションキー値」に「${clientid()}」を、<br>「レンジキー値」に「${timestamp()}」を入力します。<br><br>最後に「ロールの作成」から、DynamoDBに書き込むロールを作成して<br>「アクションの追加」を選択します。<br><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:9e5272dd-7b4e-43ed-93af-2c67006519ff/service/og-blog/media/%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%202020-11-24%20224057.png\" alt><br></p><h2 id=\"ha214098e44\">まとめ</h2><p>今回は、Raspberry PiからAWS IoT Coreに送られてくるデータを<br>AWS DynamoDBに格納する手順を紹介しました。<br><br>DynamoDBは高速でスケーラブルなデータベースですが、<br>キーインデックスの設定方法を理解するのに手惑いました。<br><br>今回までの手順で、センサで測定した気温や湿度の<br>時系列データをクラウド上のデータベースに蓄積することが<br>できるようになりました。<br><br>次は、DynamoDBからデータを取り出すWeb APIを作っていこうと思います。<br>(今年中にできればいいのですが。)<br></p>","slug":"202011-iot-dynamodb","publishedAt":"2020年11月24日","writer":"Proactive-cybernetics","tags":[{"name":"IoTデバイス","slug":"iot-device"},{"name":"Webサーバーサイド","slug":"web-server"}]}},"pageContext":{"slug":"202011-iot-dynamodb"}},"staticQueryHashes":["272570591","3000541721","3649515864"]}